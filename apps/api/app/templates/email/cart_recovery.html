<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ subject }}</title>
  <style>
    body { margin: 0; padding: 0; background-color: #f4f4f5; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
    .wrapper { width: 100%; background-color: #f4f4f5; padding: 24px 0; }
    .container { max-width: 600px; margin: 0 auto; background-color: #ffffff; border-radius: 8px; overflow: hidden; }
    .header { padding: 24px 32px; border-bottom: 1px solid #e4e4e7; }
    .header h2 { margin: 0; color: #18181b; font-size: 20px; font-weight: 600; }
    .body-content { padding: 24px 32px; color: #3f3f46; font-size: 15px; line-height: 1.6; }
    .cart-items { margin: 24px 0; }
    .cart-item { display: flex; align-items: center; padding: 12px 0; border-bottom: 1px solid #f4f4f5; }
    .cart-item:last-child { border-bottom: none; }
    .item-image { width: 64px; height: 64px; border-radius: 6px; object-fit: cover; margin-right: 16px; background-color: #f4f4f5; }
    .item-details { flex: 1; }
    .item-title { font-weight: 500; color: #18181b; font-size: 14px; margin: 0 0 4px 0; }
    .item-meta { color: #71717a; font-size: 13px; margin: 0; }
    .item-price { font-weight: 600; color: #18181b; font-size: 14px; white-space: nowrap; }
    .total-row { display: flex; justify-content: space-between; padding: 16px 0 0 0; border-top: 2px solid #e4e4e7; margin-top: 8px; }
    .total-label { font-weight: 600; color: #18181b; font-size: 16px; }
    .total-price { font-weight: 700; color: #18181b; font-size: 16px; }
    .cta-wrapper { text-align: center; padding: 8px 32px 32px 32px; }
    .cta-button { display: inline-block; padding: 14px 32px; background-color: #18181b; color: #ffffff; text-decoration: none; border-radius: 6px; font-weight: 600; font-size: 15px; }
    .footer { padding: 20px 32px; background-color: #fafafa; text-align: center; border-top: 1px solid #e4e4e7; }
    .footer p { margin: 0; color: #a1a1aa; font-size: 12px; line-height: 1.5; }
    .footer a { color: #71717a; text-decoration: underline; }
    @media only screen and (max-width: 640px) {
      .container { margin: 0 12px; }
      .header, .body-content, .cta-wrapper { padding-left: 20px; padding-right: 20px; }
      .item-image { width: 48px; height: 48px; }
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <table role="presentation" cellpadding="0" cellspacing="0" width="100%">
      <tr>
        <td align="center">
          <div class="container">
            <!-- Header -->
            <div class="header">
              <h2>{{ store_name }}</h2>
            </div>

            <!-- AI-generated body -->
            <div class="body-content">
              {{ body_html | safe }}
            </div>

            <!-- Cart Items -->
            <div class="body-content" style="padding-top: 0;">
              <div class="cart-items">
                {% for item in cart_items[:5] %}
                <table role="presentation" cellpadding="0" cellspacing="0" width="100%" style="border-bottom: 1px solid #f4f4f5;">
                  <tr>
                    {% if item.image_url %}
                    <td style="width: 64px; padding: 12px 16px 12px 0; vertical-align: top;">
                      <img src="{{ item.image_url }}" alt="{{ item.title }}" width="64" height="64" style="border-radius: 6px; object-fit: cover; display: block;">
                    </td>
                    {% endif %}
                    <td style="padding: 12px 0; vertical-align: top;">
                      <p class="item-title">{{ item.title }}</p>
                      <p class="item-meta">Qty: {{ item.quantity | default(1) }}{% if item.variant_title %} &middot; {{ item.variant_title }}{% endif %}</p>
                    </td>
                    <td style="padding: 12px 0; vertical-align: top; text-align: right; white-space: nowrap;">
                      <span class="item-price">${{ item.price }}</span>
                    </td>
                  </tr>
                </table>
                {% endfor %}

                <!-- Total -->
                <table role="presentation" cellpadding="0" cellspacing="0" width="100%" style="border-top: 2px solid #e4e4e7; margin-top: 8px;">
                  <tr>
                    <td style="padding: 16px 0 0 0;">
                      <span class="total-label">Total</span>
                    </td>
                    <td style="padding: 16px 0 0 0; text-align: right;">
                      <span class="total-price">${{ total_price }} {{ currency }}</span>
                    </td>
                  </tr>
                </table>
              </div>
            </div>

            <!-- CTA Button -->
            <div class="cta-wrapper">
              <a href="{{ checkout_url }}" class="cta-button" target="_blank">{{ cta_text }}</a>
            </div>

            <!-- Footer -->
            <div class="footer">
              <p>
                You're receiving this email because you started a checkout at {{ store_name }}.
                <br>
                <a href="{{ unsubscribe_url }}">Unsubscribe from recovery emails</a>
              </p>
            </div>
          </div>
        </td>
      </tr>
    </table>
  </div>
</body>
</html>
